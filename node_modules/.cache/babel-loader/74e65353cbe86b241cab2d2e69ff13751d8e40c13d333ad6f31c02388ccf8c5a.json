{"ast":null,"code":"import React,{useState,useEffect}from'react';import{ethers}from'ethers';import UserAgreement from'./UserAgreement';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const JoinDAO=_ref=>{let{daoAddress,userAddress,onJoin}=_ref;const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[agreementAccepted,setAgreementAccepted]=useState(false);useEffect(()=>{const inviteKey=`invite_${daoAddress}_${userAddress}`;const storedInvite=localStorage.getItem(inviteKey);if(storedInvite){const invite=JSON.parse(storedInvite);if(invite.status==='pending'){setAgreementAccepted(true);// If already accepted agreement before\n}}},[daoAddress,userAddress]);const handleJoin=async()=>{try{setLoading(true);setError('');const inviteKey=`invite_${daoAddress}_${userAddress}`;const storedInvite=localStorage.getItem(inviteKey);if(!storedInvite){throw new Error('You must be invited to join this DAO');}const invite=JSON.parse(storedInvite);if(invite.status!=='pending'){throw new Error('This invitation has already been used');}// Update invite status\ninvite.status='accepted';invite.acceptedAt=Date.now();localStorage.setItem(inviteKey,JSON.stringify(invite));// Proceed with joining\nawait onJoin(daoAddress,userAddress);}catch(err){setError(err.message);}finally{setLoading(false);}};const handleAgreementAccept=()=>{setAgreementAccepted(true);};if(!agreementAccepted){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto p-4\",children:/*#__PURE__*/_jsx(UserAgreement,{onAccept:handleAgreementAccept})});}return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Join DAO\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\",children:error}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-4\",children:\"You have been invited to join this DAO. Click the button below to accept.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleJoin,disabled:loading,className:`w-full py-2 px-4 rounded-md text-white font-semibold ${loading?'bg-gray-400 cursor-not-allowed':'bg-blue-600 hover:bg-blue-700'}`,children:loading?'Joining...':'Join DAO'})]})});};export default JoinDAO;","map":{"version":3,"names":["React","useState","useEffect","ethers","UserAgreement","jsx","_jsx","jsxs","_jsxs","JoinDAO","_ref","daoAddress","userAddress","onJoin","loading","setLoading","error","setError","agreementAccepted","setAgreementAccepted","inviteKey","storedInvite","localStorage","getItem","invite","JSON","parse","status","handleJoin","Error","acceptedAt","Date","now","setItem","stringify","err","message","handleAgreementAccept","className","children","onAccept","onClick","disabled"],"sources":["/home/impromise/Downloads/OpenDevin_backup/agu-app-03-28-25-07-28/dao-frontend/src/components/dao/JoinDAO.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { ethers } from 'ethers';\nimport UserAgreement from './UserAgreement';\n\nconst JoinDAO = ({ daoAddress, userAddress, onJoin }) => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [agreementAccepted, setAgreementAccepted] = useState(false);\n\n  useEffect(() => {\n    const inviteKey = `invite_${daoAddress}_${userAddress}`;\n    const storedInvite = localStorage.getItem(inviteKey);\n\n    if (storedInvite) {\n      const invite = JSON.parse(storedInvite);\n      if (invite.status === 'pending') {\n        setAgreementAccepted(true); // If already accepted agreement before\n      }\n    }\n  }, [daoAddress, userAddress]);\n\n  const handleJoin = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const inviteKey = `invite_${daoAddress}_${userAddress}`;\n      const storedInvite = localStorage.getItem(inviteKey);\n\n      if (!storedInvite) {\n        throw new Error('You must be invited to join this DAO');\n      }\n\n      const invite = JSON.parse(storedInvite);\n      if (invite.status !== 'pending') {\n        throw new Error('This invitation has already been used');\n      }\n\n      // Update invite status\n      invite.status = 'accepted';\n      invite.acceptedAt = Date.now();\n      localStorage.setItem(inviteKey, JSON.stringify(invite));\n\n      // Proceed with joining\n      await onJoin(daoAddress, userAddress);\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAgreementAccept = () => {\n    setAgreementAccepted(true);\n  };\n\n  if (!agreementAccepted) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-4\">\n        <UserAgreement onAccept={handleAgreementAccept} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-md mx-auto p-4\">\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <h2 className=\"text-2xl font-bold mb-4\">Join DAO</h2>\n        \n        {error && (\n          <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">\n            {error}\n          </div>\n        )}\n\n        <p className=\"mb-4\">\n          You have been invited to join this DAO. Click the button below to accept.\n        </p>\n\n        <button\n          onClick={handleJoin}\n          disabled={loading}\n          className={`w-full py-2 px-4 rounded-md text-white font-semibold ${\n            loading\n              ? 'bg-gray-400 cursor-not-allowed'\n              : 'bg-blue-600 hover:bg-blue-700'\n          }`}\n        >\n          {loading ? 'Joining...' : 'Join DAO'}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default JoinDAO; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}